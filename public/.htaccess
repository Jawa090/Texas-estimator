<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # 1. Force HTTPS and Remove WWW in a single step
  # Handles http://domain.com, http://www.domain.com, and https://www.domain.com
  RewriteCond %{HTTP_HOST} ^www\. [NC,OR]
  RewriteCond %{HTTPS} off
  RewriteCond %{HTTP_HOST} ^(?:www\.)?(.+)$ [NC]
  RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L,NE]

  # 2. React Router Fallback
  # Serve index.html for any request that is not a real file or directory
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>
